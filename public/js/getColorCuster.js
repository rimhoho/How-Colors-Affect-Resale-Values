let colorWayNname = [{target: '380 Onyx', fullRGB: ["52 44 48", "82 69 70", "33 32 38"]},
                    {target: '700 V3 Safflower', fullRGB: ["250 247 244", "231 207 97", "36 36 38"]},
                    {target: '350 V2 Fade', fullRGB: ["134 119 112", "83 82 103", "210 207 211"]},
                    {target: '380 Calcite Glow', fullRGB: ["241 242 239", "201 200 195", "239 238 220"]},
                    {target: '350 V2 Natural', fullRGB: ["237 236 229", "238 232 194", "221 212 196"]},
                    {target: 'QNTM Teal Blue', fullRGB: ["110 103 110", "117 142 143", "44 44 46"]}, 
                    {target: '350 V2 Carbon', fullRGB: ["26 29 28", "82 84 88", "215 218 201"]}, 
                    {target: '380 Pepper', fullRGB: ["204 192 192", "203 172 135", "189 172 164"]}, 
                    {target: '700 V3 Arzareth', fullRGB: ["85 132 166", "31 28 29", "236 238 240"]}, 
                    {target: '350 V2 Israfil', fullRGB: ["151 155 156", "166 132 86", "199 292 294"]}, 
                    {target: '380 Blue Oat', fullRGB: ["172 134 78", "78 105 164", "201 138 111"]}, 
                    {target: '350 V2 Zyon', fullRGB: ["132 124 118", "30 30 30", "253 255 245"]}, 
                    {target: '700 MNVN Bone', fullRGB: ["245 240 228", "160 161 168", "24 22 18"]}, 
                    {target: 'QNTM Barium', fullRGB: ["91 90 87", "138 135 130", "19 22 21"]}, 
                    {target: '350 V2 Sulfur', fullRGB: ["194 189 153", "153 150 108", "112 118 80"]}, 
                    {target: '700 MNVN Phosphor', fullRGB: ["222 235 153", "216 218 224", "56 55 58"]}, 
                    {target: '350 V2 Linen', fullRGB: ["203 188 161", "139 144 149", "232 212 166"]}, 
                    {target: '700 V3 Alvah', fullRGB: ["40 42 44", "64 65 69", "40 42 44"]}, 
                    {target: '380 Mist', fullRGB: ["152 146 139", "203 169 143", "245 239 223"]}, 
                    {target: '350 V2 Cinder', fullRGB: ["30 30 32", "28 30 31", "88 89 86"]}, 
                    {target: '350 V2 Desert Sage', fullRGB: ["157 160 132", "157 160 143", "255 129 103"]}, 
                    {target: '700 MNVN Orange', fullRGB: ["252 161 98", "138 141 152", "4243 37"]}, 
                    {target: '350 V2 Tail Light', fullRGB: ["184 180 179", "251 67 49", "210 202 193"]}, 
                    {target: '350 V2 Earth', fullRGB: ["137 117 97", "73 64 51", "126 119 110"]}, 
                    {target: '350 V2 Flax', fullRGB: ["202 201 142", "209 207 151", "227 209 165"]}, 
                    {target: 'QNTM Lifestyle Model', fullRGB: ["98 99 106", "157 158 164", "28 28 30"]}, 
                    {target: '700 MNVN Triple Black', fullRGB: ["36 40 42", "53 54 58", "33 35 37"]}, 
                    {target: '350 V2 Marsh', fullRGB: ["198 193 140", "148 146 148", "231 219 153"]}, 
                    {target: '350 V2 Yeshaya', fullRGB: ["237 234 227", "120 120 120", "219 217 191"]}, 
                    {target: '700 V3 Azael', fullRGB: ["253 253 241", "22 24 25", "210 204 198"]}, 
                    {target: '350 V2 Yecheil', fullRGB: ["32 32 34", "72 22 29", "201 208 179"]}, 
                    {target: '700 Carbon Blue', fullRGB: ["111 110 128", "161 162 169", "98 92 103"]}, 
                    {target: '350 V2 Yeezreel', fullRGB: ["199 224 183", "204 221 156", "63 76 71"]}, 
                    {target: '380 Alien', fullRGB: ["226 228 216", "170 170 173", "227 237 218"]}, 
                    {target: '500 Stone', fullRGB: ["203 196 182", "177 171 157", "217 214 195"]}, 
                    {target: '500 Soft Vision', fullRGB: ["198 176 186", "171 149 170", "204 182 191"]}, 
                    {target: '700 Teal Blue', fullRGB: ["110 106 116", "66 68 74", "158 161 168"]}, 
                    {target: '700 V2 Hospital Blue', fullRGB: ["156 168 180", "160 180 192", "139 153 166"]}, 
                    {target: '350 V2 Citrin', fullRGB: ["211 211 199", "159 158 149", "191 201 188"]}, 
                    {target: '350 V2 Cloud White', fullRGB: ["174 191 199", "231 228 218", "153 172 176"]}, 
                    {target: '700 Magnet', fullRGB: ["148 150 160", "242 238 229", "255 144 95"]}, 
                    {target: '700 V2 Inertia', fullRGB: ["154 167 189", "251 166 121", "129 143 158"]}, 
                    {target: '500 Bone White', fullRGB: ["244 241 233", "214 211 203", "207 199 189"]}, 
                    {target: '350 V2 Lundmark', fullRGB: ["235 230 220", "162 159 158", "193 182 165"]}, 
                    {target: '700 Utility Black', fullRGB: ["45 46 56", "63 62 67", "114 96 79"]}, 
                    {target: '350 V2 Antlia', fullRGB: ["188 190 133", "213 209 168", "229 228 205"]}, 
                    {target: '350 V2 Synth', fullRGB:  ["203 182 178", "180 173 174", "235 214 194"]}, 
                    {target: '700 V2 Tephra', fullRGB:  ["152 145 146", "80 77 80", "99 107 111"]}, 
                    {target: '350 V2 Black', fullRGB:  ["29 34 36", "112 29 35", "22 24 30"]}, 
                    {target: '700 V2 Vanta', fullRGB:  ["26 24 30", "33 33 36", "49 50 56"]}, 
                    {target: '350 V2 Glow', fullRGB:  ["186 243 161", "235 239 176", "147 227 121"]}, 
                    {target: '700 Analog', fullRGB:  ["253 248 235", "140 148 166", "212 210 209"]}, 
                    {target: '350 V2 Clay', fullRGB:  ["195 150 136", "252 201 127", "247 188 155"]}, 
                    {target: '700 V2 Geode', fullRGB:  ["92 89 88", "55 54 53", "65 71 78"]}, 
                    {target: '350 V2 Trfrm', fullRGB:  ["183 180 181", "239 157 130", "220 197 188"]}, 
                    {target: '350 V2 Hyperspace', fullRGB:  ["241 246 233", "214 194 146", "212 222 215"]}, 
                    {target: '700 Inertia', fullRGB:  ["153 169 185", "249 173 156", "186 193 204"]}, 
                    {target: '700 Salt', fullRGB:  ["184 193 192", "183 180 169", "208 209 202"]}, 
                    {target: '700 V2 Static', fullRGB:  ["233 232 227", "158 160 173", "176 173 178"]}, 
                    {target: '350 V2 Static', fullRGB:  ["231 233 235", "149 149 163", "241 244 242"]}, 
                    {target: '500 Salt', fullRGB:  ["186 197 200", "162 166 169", "178 173 170"]}, 
                    {target: '350 V2 Sesame', fullRGB:  ["215 212 204", "194 191 182", "225 222 200"]}, 
                    {target: '700 Mauve', fullRGB:  ["92 86 83", "64 66 69", "185 220 118"]}, 
                    {target: '500 Utility Black', fullRGB:  ["22 23 27", "49 51 57", "37 39 38"]}, 
                    {target: '350 V2 Butter', fullRGB: ["225 225 208", "231 235 213", "221 222 203"]}, 
                    {target: '500 Super Moon Yellow', fullRGB:  ["220 217 193", "219 218 179", "203 199 164"]}, 
                    {target: '500 Blush', fullRGB:  ["202 194 174", "192 180 164", "179 171 151"]}, 
                    {target: '350 V2 Blue Tint', fullRGB: ["208 216 209", "233 67 64", "144 142 140"]}, 
                    {target: '350 V2 Beluga 2.0', fullRGB: ["119 118 116", "222 76 77", "43 41 44"]}, 
                    {target: '350 V2 Semi Frozen Yellow', fullRGB: ["215 233 138", "213 91 57", "90 96 98"]}, 
                    {target: '700 Wave Runner', fullRGB: ["150 148 148", "255 116 70", "236 231 222"]}, 
                    {target: '350 V2 Cream Triple White', fullRGB: ["243 242 233", "224 225 220", "237 236 227"]}, 
                    {target: '350 V2 Zebra', fullRGB: ["231 231 231", "22 27 27", "183 40 38"]}, 
                    {target: '350 V2 Black Red', fullRGB: ["20 21 23", "201 72 75", "21 19 22"]}, 
                    {target: '350 V2 Core Black White', fullRGB: ["26 26 26", "240 234 214", "19 22 21"]}, 
                    {target: '350 V2 Core Black Red', fullRGB: ["28 27 32", "234 63 66", "7 8 13"]}, 
                    {target: '350 V2 Core Black Green', fullRGB: ["39 39 43", "122 114 103", "10 14 15"]}, 
                    {target: '350 V2 Core Black Copper', fullRGB: ["31 33 34", "141 102 88", "37 37 43"]}, 
                    {target: '350 V2 Beluga', fullRGB: ["126 125 121", "253 84 46", "67 63 30"]}, 
                    {target: '350 Pirate Black 2016', fullRGB: ["23 25 24", "115 34 35", "25 29 33"]}, 
                    {target: '350 Oxford Tan', fullRGB: ["203 192 174", "158 147 128", "190 169 144"]}, 
                    {target: '350 Moonrock', fullRGB: ["143 142 132", "101 100 93", "163 159 154"]}, 
                    {target: '350 Pirate Black 2015', fullRGB: ["52 42 46", "128 55 46", "35 30 34"]}, 
                    {target: '350 Turtledove', fullRGB: ["139 137 129", "62 61 52", "253 251 240"]}]

  // Euclidean Distance formula
  function deltaE(rgbA, rgbB) {
    let labA = rgb2lab(rgbA);
    let labB = rgb2lab(rgbB);
    let deltaL = labA[0] - labB[0];
    let deltaA = labA[1] - labB[1];
    let deltaB = labA[2] - labB[2];
    let c1 = Math.sqrt(labA[1] * labA[1] + labA[2] * labA[2]);
    let c2 = Math.sqrt(labB[1] * labB[1] + labB[2] * labB[2]);
    let deltaC = c1 - c2;
    let deltaH = deltaA * deltaA + deltaB * deltaB - deltaC * deltaC;
    deltaH = deltaH < 0 ? 0 : Math.sqrt(deltaH);
    let sc = 1.0 + 0.045 * c1;
    let sh = 1.0 + 0.015 * c1;
    let deltaLKlsl = deltaL / (1.0);
    let deltaCkcsc = deltaC / (sc);
    let deltaHkhsh = deltaH / (sh);
    let i = deltaLKlsl * deltaLKlsl + deltaCkcsc * deltaCkcsc + deltaHkhsh * deltaHkhsh;
    return i < 0 ? 0 : Math.sqrt(i);
  }
  
  function rgb2lab(rgb){
    let r = rgb[0] / 255, g = rgb[1] / 255, b = rgb[2] / 255, x, y, z;
    r = (r > 0.04045) ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
    g = (g > 0.04045) ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
    b = (b > 0.04045) ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;
    x = (r * 0.4124 + g * 0.3576 + b * 0.1805) / 0.95047;
    y = (r * 0.2126 + g * 0.7152 + b * 0.0722) / 1.00000;
    z = (r * 0.0193 + g * 0.1192 + b * 0.9505) / 1.08883;
    x = (x > 0.008856) ? Math.pow(x, 1/3) : (7.787 * x) + 16/116;
    y = (y > 0.008856) ? Math.pow(y, 1/3) : (7.787 * y) + 16/116;
    z = (z > 0.008856) ? Math.pow(z, 1/3) : (7.787 * z) + 16/116;
    return [(116 * y) - 16, 500 * (x - y), 200 * (y - z)]
  }

  // function _distance(v1, v2) {
  //   var total = 0;
  //   for (var i = 0; i < v1.length; i++) {
  //     total += Math.pow(v2[i] - v1[i], 2);      
  //   }
  //   return Math.sqrt(total);
  // }

  function _findIdx(arr, initItem) {
    let index = parseInt(arr.map((item, index) => item.target == initItem && index).reduce((a, b) => a + b));
    return index
  }
  function _popNReminder(arr, initItem) {
    let copyArr = [...arr];
    arr.filter((item, index) => item.target == initItem && copyArr.splice(index, 1))
    return copyArr
  }

  let saveData = (function () {
    let a = document.createElement("a");
    document.body.appendChild(a);
    a.style = "display: none";
    return function (data, fileName) {
        var json = JSON.stringify(data),
            blob = new Blob([json], {type: "octet/stream"}),
            url = window.URL.createObjectURL(blob);
        a.href = url;
        a.download = fileName;
        a.click();
        window.URL.revokeObjectURL(url);
    };
  }());

  let initItem = '350 V2 Core Black Red'
  let initIdx = _findIdx(colorWayNname, initItem)
  let deltaECollection = [{target: initItem, fullRGB: colorWayNname[initIdx].fullRGB, distance_primary: 0}]

  function getPrimaryColor(arr, name) {
    let reminderArr = _popNReminder(arr, name)
    let targetIdx = _findIdx(arr, name)

    let tempValue = [];
    let tempName = [];
    if (reminderArr.length != 0){
      reminderArr.forEach(item => { 
        let distance = parseFloat(deltaE(item.fullRGB[0].split(' ').map(d => parseInt(d)), arr[targetIdx].fullRGB[0].split(' ').map(d => parseInt(d))).toFixed(2));
        tempValue.push(distance)
        tempName.push(item.target)
      })
      let minDst = Math.min(...tempValue)
      let minIdx = tempValue.indexOf(minDst)
      let minName = tempName[minIdx]
      deltaECollection.push({target: minName, fullRGB: reminderArr[minIdx].fullRGB, distance_primary: minDst})
      getPrimaryColor(reminderArr, minName);
    } else {
      let num = 0;
      deltaECollection.forEach(item => {
        let distance_highlight = parseFloat(deltaE(item.fullRGB[0].split(' ').map(d => parseInt(d)), item.fullRGB[1].split(' ').map(d => parseInt(d))).toFixed(2));
        item.distance_highlight = distance_highlight

        if (item.distance_primary <= 9.43) {
          item.cluster = `cluster${num}`
        } else if (item.distance_primary > 9.43) {
          num += 1
          item.cluster = `cluster${num}`
        }
      })
      // saveData(deltaECollection, 'deltaE.json');
      return;
    }
  }
  getPrimaryColor(colorWayNname, initItem)

  